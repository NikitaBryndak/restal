<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Пошук турів — RestAL</title>
  <script>
    var osGeo = '';
    var osDefaultDeparture = 2025;
    var osDefaultDuration = '';
    var osDateFrom = '';
    var osDateTo = '';
    var osHotelCategory = '';
    var osFood = '';
    var osTransport = '';
    var osTarget = '';
    var osContainer = null;
    var osTourContainer = null;
    var osLang = 'ua';
    var osTourTargetBlank = false;
    var osOrderUrl = null;
    var osCurrency = 'converted';
    var osAutoStart = false;
  </script>
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700&subset=cyrillic" rel="stylesheet" />
  <link rel="stylesheet" href="https://export.otpusk.com/os/onsite/form.css" type="text/css" />
  <link rel="stylesheet" href="https://export.otpusk.com/os/onsite/result.css" type="text/css" />
  <link rel="stylesheet" href="https://export.otpusk.com/os/onsite/tour.css" type="text/css" />
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html, body {
      font-family: 'Open Sans', sans-serif;
      background: transparent;
      overflow-x: hidden;
    }
    body { padding: 0; }
    .os-form, .os-results, .os-tour {
      max-width: 100% !important;
      width: 100% !important;
    }
    /* Force advanced search panel to be visible (Old & New classes) */
    .os-form-advanced,
    .os-form .advanced,
    .os-form-ext,
    .os-form-extra,
    .os-form-more,
    .os-form-toggle + div,
    .os-form-toggle + fieldset,
    .os-form-toggle ~ div[style*="display: none"],
    .os-form-toggle ~ div[style*="display:none"],
    /* New classes */
    .new_f-ext-container,
    .new_f-ext-body,
    div[class*="ext-container"],
    div[class*="ext-body"],
    .new_f-ext-wrap {
      display: block !important;
      height: auto !important;
      overflow: visible !important;
      opacity: 1 !important;
      visibility: visible !important;
      max-height: none !important;
    }

    /* Hide the toggle button if it's expanded by CSS to avoid confusion,
       or keep it. Usually better to keep it but ensure content is shown. */

    /* Collapsed state: hide extended search options when search is clicked */
    body.ext-collapsed .os-form-advanced,
    body.ext-collapsed .os-form .advanced,
    body.ext-collapsed .os-form-ext,
    body.ext-collapsed .os-form-extra,
    body.ext-collapsed .os-form-more,
    body.ext-collapsed .os-form-toggle + div,
    body.ext-collapsed .os-form-toggle + fieldset,
    body.ext-collapsed .new_f-ext-container,
    body.ext-collapsed .new_f-ext-body,
    body.ext-collapsed div[class*="ext-container"],
    body.ext-collapsed div[class*="ext-body"],
    body.ext-collapsed .new_f-ext-wrap {
      display: none !important;
      height: 0 !important;
      overflow: hidden !important;
      opacity: 0 !important;
      visibility: hidden !important;
      max-height: 0 !important;
    }
  </style>
</head>
<body>
  <script>
    // Intercept "Замовити тур" button clicks (capture phase, runs before widget handlers)
    document.addEventListener('click', function(e) {
      var el = e.target;
      while (el && el !== document.body) {
        var text = el.textContent ? el.textContent.trim() : '';
        if (text === 'Замовити тур' && /^(A|BUTTON|DIV|SPAN)$/i.test(el.tagName)) {
          e.preventDefault();
          e.stopPropagation();
          e.stopImmediatePropagation();
          var codeMatch = document.body.textContent.match(/Код[:\s]*(\d+)/);
          var hotelEl = document.querySelector('.tour-name, .os-tour-name, h1, h2');
          window.parent.postMessage({
            type: 'otpusk-order',
            tourCode: codeMatch ? codeMatch[1] : '',
            hotelName: hotelEl ? hotelEl.textContent.trim() : ''
          }, '*');
          return false;
        }
        el = el.parentElement;
      }
    }, true);
  </script>
  <script src="https://api.otpusk.com/api/2.4/session?access_token=3f80a-01423-b3ca6-0bbab-1a284"></script>
  <script src="https://export.otpusk.com/js/onsite/"></script>
  <script src="https://export.otpusk.com/js/order"></script>
  <script>
    // Auto-expand "Розширений пошук" after widget initializes
    (function() {
      var done = false;
      function tryExpand() {
        if (done) return true;

        // Common text variations for "Extended search"
        var searchTexts = ["Розширений пошук", "Расширенный поиск", "Extended search", "Параметри пошуку"];

        // Try multiple strategies to find the button
        var strategies = [
           function() {
              // 1. Try generic class names for the button
              return document.querySelector('.new_f-ext-btn, .new_f-more-btn, [class*="ext-btn"], [class*="more-btn"]');
           },
           function() {
              // 2. Try by text content (recursive)
              return findToggleByText(searchTexts);
           },
           function() {
              // 3. Fallback: Find ANY element containing the text and click it directly
              for (var i = 0; i < searchTexts.length; i++) {
                 var t = searchTexts[i].toLowerCase();
                 // Create XPath for text content matching (case insensitive using translate hack)
                 // Note: we need to careful with quotes in XPath
                 var xpath = "//*[text()[contains(translate(., 'ABCDEFGHIJKLMNOPQRSTUVWXYZАБВГДЕЄЖЗИІЇЙКЛМНОПРСТУФХЦЧШЩЬЮЯ', 'abcdefghijklmnopqrstuvwxyzabhgdeezzijklmnoprstufhcchshschyuya'), '" + t + "')]]";
                 try {
                     var result = document.evaluate(xpath, document.body, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null);
                     if (result.singleNodeValue) {
                        return result.singleNodeValue;
                     }
                 } catch(e) { console.error("XPath error", e); }
              }
              return null;
           }
        ];

        function findToggleByText(texts) {
          // ... (keep logic, but wrapped)
          for (var t of texts) {
             var toggle = findToggle(t);
             if (toggle) return toggle;
          }
          return null;
        }

        // Helper to find valid toggle elements
        function findToggle(text) {
          var lowerText = text.toLowerCase();
          // Use TreeWalker ... (same as before)
          var treeWalker = document.createTreeWalker(document.body, NodeFilter.SHOW_TEXT, null, false);

          while(treeWalker.nextNode()) {
            var node = treeWalker.currentNode;
            if (node.textContent.toLowerCase().indexOf(lowerText) !== -1) {
                var element = node.parentElement;
                var toggle = element.closest('a, button, [class*="toggle"], [class*="more"], [class*="advanced"], [class*="ext-btn"], span[onclick], div[onclick]');

                if (toggle && toggle.offsetParent !== null) {
                   return toggle;
                }
            }
          }
          return null;
        }

        for (var i = 0; i < strategies.length; i++) {
          var toggle = strategies[i]();
          if (toggle) {
             // Dispatch a click event properly
             // ...
             // Check if it looks expanded already?
             // Maybe check if next sibling is visible?
             // But let's just click it.

             // For jQuery click
             if (window.jQuery) {
                window.jQuery(toggle).click();
                done = true;
                return true;
             }

             if (typeof toggle.click === 'function') {
                 toggle.click();
             }

             var event = new MouseEvent('click', {
                view: window,
                bubbles: true,
                cancelable: true
             });
             toggle.dispatchEvent(event);

             done = true;
             return true;
          }
        }

        return false;
      }

      // Observe DOM changes to catch when the widget loads
      var obs = new MutationObserver(function(mutations) {
        if (tryExpand()) {
           // Keep observing for a bit in case it re-renders
           setTimeout(() => obs.disconnect(), 2000);
        }
      });

      obs.observe(document.body, { childList: true, subtree: true });

      // Periodic checks as fallback
      var intervals = [500, 1000, 2000, 4000, 8000];
      intervals.forEach(function(t) {
        setTimeout(tryExpand, t);
      });

    })();

    // Collapse extended search options when the search button is clicked
    (function() {
      function attachSearchCollapse() {
        var searchBtn = document.querySelector(
          'button[type="submit"], input[type="submit"], .new_f-submit, .new_f-search-btn, ' +
          '[class*="submit"], [class*="search-btn"], .os-form button, .os-form input[type="submit"]'
        );

        if (!searchBtn) {
          // Also try finding by text content
          var btns = document.querySelectorAll('button, input[type="submit"], a.btn, [role="button"]');
          for (var i = 0; i < btns.length; i++) {
            var txt = (btns[i].textContent || btns[i].value || '').trim().toLowerCase();
            if (txt === 'знайти' || txt === 'пошук' || txt === 'найти' || txt === 'поиск' || txt === 'search') {
              searchBtn = btns[i];
              break;
            }
          }
        }

        if (searchBtn && !searchBtn._collapseAttached) {
          searchBtn._collapseAttached = true;
          searchBtn.addEventListener('click', function() {
            document.body.classList.add('ext-collapsed');
          });
          return true;
        }
        return false;
      }

      // Observe DOM for widget load, then attach
      var obs2 = new MutationObserver(function() {
        if (attachSearchCollapse()) {
          setTimeout(function() { obs2.disconnect(); }, 2000);
        }
      });
      obs2.observe(document.body, { childList: true, subtree: true });

      [500, 1000, 2000, 4000, 8000].forEach(function(t) {
        setTimeout(attachSearchCollapse, t);
      });
    })();
  </script>
  <script>
    (function () {
      var lastHeight = 0;
      function postHeight() {
        var height = Math.max(
          document.body.scrollHeight,
          document.body.offsetHeight,
          document.documentElement.scrollHeight,
          document.documentElement.offsetHeight
        );
        if (height !== lastHeight) {
          lastHeight = height;
          window.parent.postMessage({ type: 'otpusk-resize', height: height }, '*');
        }
      }
      setInterval(postHeight, 150);
      window.addEventListener('load', postHeight);
      window.addEventListener('resize', postHeight);
      if (window.MutationObserver) {
        new MutationObserver(postHeight).observe(document.body, {
          childList: true, subtree: true, attributes: true, characterData: true
        });
      }
    })();
  </script>
</body>
</html>
